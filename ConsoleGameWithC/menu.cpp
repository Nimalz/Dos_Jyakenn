#include "menu.h"
#include "renderer.h"
#include "input.h"

int menuCnt;
int cursor_menu;   //カーソルの現在位置を保存する
int menuMode;
#ifdef _DEBUG
bool IsFrameRenewed = false; //今輸出してるframeは前のframeと違ってますか？
#endif
char menu[ANI_FRAME * DISP_H][DISP_V] =
{
	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃                                                                             ┃\n",
	"┃           ■      ■  ■                                                    ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■                  ■    ■■          ■                        ┃\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃                                                                             ┃\n",
	"┃           ■      ■  ■                                                    ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■                  ■    ■■          ■                        ┃\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■      ■  ■                                                    ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■                  ■    ■■          ■                        ┃\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■                  ■    ■■          ■                        ┃\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",


	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■      ■  ■                          ■                        ┃\n",
	"┃           ■                  ■    ■■          ■                        ┃\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",
	"┃                                                                             ┃\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■                  ■    ■■          ■                        ┃\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                 TUTORIAL                                    ┃\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■                ■■■■■■■■      ■■■■                  ┃\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                 TUTORIAL                                    ┃\n",
	"┃                                                                             ┃\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■                  ■■  ■    ■      ■    ■■                ┃\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                 TUTORIAL                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                   EXIT                                      ┃\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■        ■          ■    ■■        ■      ■    ■          ┃\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                 TUTORIAL                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                   EXIT                                      ┃\n",
	"┃                                                                             ┃\n",

	"┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n",
	"┃           ■        ■          ■                ■      ■  ■■          ┃\n",
	"┃           ■■■■            ■                ■        ■                ┃\n",
	"┃                                                                             ┃\n",
	"┃                                ■                                           ┃\n",
	"┃                  ■              ■          ■                             ┃\n",
	"┃                  ■        ■■■■■■      ■                             ┃\n",
	"┃                  ■            ■■          ■                             ┃\n",
	"┃                  ■              ■          ■■■■                       ┃\n",
	"┃                  ■              ■          ■    ■■                     ┃\n",
	"┃                  ■■■          ■          ■      ■    ■               ┃\n",
	"┃                    ■■        ■■          ■      ■  ■■               ┃\n",
	"┃                    ■          ■            ■        ■                   ┃\n",
	"┃                                                                             ┃\n",
	"┃                                                                             ┃\n",
	"┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",
	"┃                                                                             ┃\n",
	"┃                                 NEW GAME                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                 TUTORIAL                                    ┃\n",
	"┃                                                                             ┃\n",
	"┃                                   EXIT                                      ┃\n",
	"┃                                                                             ┃\n",
	"┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n",
};

BufferLine BufferFrame[DISP_H] =
{
					 { "┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\n", 1 },
					 { "┃           ■        ■          ■                ■      ■  ■■          ┃\n",2},
					 { "┃           ■■■■            ■                ■        ■                ┃\n",3},
					 { "┃                                                                             ┃\n",4},
					 { "┃                                ■                                           ┃\n",5},
					 { "┃                  ■              ■          ■                             ┃\n",6},
					 { "┃                  ■        ■■■■■■      ■                             ┃\n",7},
					 { "┃                  ■            ■■          ■                             ┃\n",8},
					 { "┃                  ■              ■          ■■■■                       ┃\n",9},
					 { "┃                  ■              ■          ■    ■■                     ┃\n",10},
					 { "┃                  ■■■          ■          ■      ■    ■               ┃\n",11},
					 { "┃                    ■■        ■■          ■      ■  ■■               ┃\n",12},
					 { "┃                    ■          ■            ■        ■                   ┃\n",13},
					 { "┃                                                                             ┃\n",14},
					 { "┃                                                                             ┃\n",15},
					 { "┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫\n",16 },
					 { "┃                                                                             ┃\n",17},
					 { "┃                                 NEW GAME                                    ┃\n",18},
					 { "┃                                                                             ┃\n",19},
					 { "┃                                 TUTORIAL                                    ┃\n",20},
					 { "┃                                                                             ┃\n",21},
					 { "┃                                   EXIT                                      ┃\n",22},
					 { "┃                                                                             ┃\n",23},
					 { "┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\n",24},
};

BufferLine newGame = { "┃                          　  → NEW GAME                                    ┃\n",18 };
BufferLine cont    = { "┃                              → TUTORIAL                                    ┃\n",20 };
BufferLine ext     = { "┃                              →   EXIT                                      ┃\n",22 };




void InitMenu(void)
{
	menuCnt = 0;
	menuMode = MENU_ANI;
	cursor_menu = NEW;
}

void UninitMenu(void)
{

}

void UpdateMenu(void)
{
	switch (menuMode)
	{
	case MENU_ANI:
		UpdateAni();
		break;
	case MENU_LOOP:
		UpdateMenuLoop();
		break;
	}
}

void DrawMenu(void)
{
	switch (menuMode)
	{
	case MENU_ANI:
		DrawAni();
		break;
	case MENU_LOOP:
		DrawMenuLoop();
		break;
	}
}

void UpdateAni(void)
{
	menuCnt++;
	system("cls");
	if (menuCnt >= ANI_FRAME)
	{
		menuMode = MENU_LOOP;
		menuCnt = 0;
		cursor_menu = NEW;			//カーソルをnewに設置する
	}
}

void UpdateMenuLoop(void)
{
	// 処理を行う前にキー入力があったかをチェックする
	KBHIT()
		// キー入力処理
	keyInputMenu();

	system("cls");		 // 画面クリア
}

void DrawAni(void)
{
	DrawFrame(ANI_TIME, menu, &menuCnt);
}

void DrawMenuLoop(void)
{
	switch (cursor_menu)
	{
	case NEW:
		printBufferFrame(BufferFrame);
		Sleep(ANI_FLASH_TIME);
		system("cls");
		printWithRenew(BufferFrame,newGame);
		Sleep(ANI_LOOP_TIME);
		break;
	case CONT:
		printBufferFrame(BufferFrame);
		Sleep(ANI_FLASH_TIME);
		system("cls");
		printWithRenew(BufferFrame, cont);
		Sleep(ANI_LOOP_TIME);
		break;
	case EXIT:
		printBufferFrame(BufferFrame);
		Sleep(ANI_FLASH_TIME);
		system("cls");
		printWithRenew(BufferFrame, ext);
		Sleep(ANI_LOOP_TIME);

		break;
	}

}

int GetCur(void)
{
	return cursor_menu;
}

void SetCur(int temp)
{
	cursor_menu = temp;
}

#ifdef _DEBUG
void menutest(void)
{

	//BufferRewnwArray(bufferFrame, aaa, 3);
	//printBufferFrame(bufferFrame);

}

bool GetRenewFlag(void)
{
	return IsFrameRenewed;
}

void SetRenewFlag(bool in)
{
	IsFrameRenewed = in;
}

#endif